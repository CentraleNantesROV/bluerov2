<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

<xacro:property name="x_camera" value="0.02"/>
<xacro:property name="PI" value="3.1415927"/>

<xacro:macro name="imu" params="name *origin">
    <link name="${ns}/${name}">
        <inertial>                
            <inertia ixx="0.00001" ixy="0.0" ixz="0.0" iyy="0.00001" iyz="0.0" izz="0.00001" />
            <mass value="0.015" /> 
        </inertial>
        <sensor name="${name}_imu" type="imu">
            <always_on>1</always_on>
            <update_rate>1</update_rate>
            <visualize>true</visualize>
            <topic>${name}</topic>
        </sensor>
    </link>
    <gazebo reference="${ns}/${name}">

         <plugin
            filename="libgz-sim-imu-system.so"
            name="gz::sim::systems::Imu">
             <link_name>${ns}/${name}</link_name>
        </plugin>
    </gazebo>
 
     <joint name="${name}" type="fixed">
        <xacro:insert_block name="origin"/>
        <parent link="${ns}/base_link"/>
        <child link="${ns}/${name}"/>
    </joint>    
</xacro:macro>

<xacro:imu name="mpu">
    <origin xyz="0.1 0 0" rpy="0 0 ${-PI/2}"/>
</xacro:imu>

<xacro:imu name="lsm">
    <origin xyz="0.1 0 0" rpy="0 0 ${-PI/2}"/>
</xacro:imu>

  
  <!-- Pressure Sensor  -->
<!--  <xacro:default_pressure parent_link="${ns}/base_link" sensor_name="baro">
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </xacro:default_pressure>-->
  
  
  <link name="${ns}/camera">
    <inertial>
    <mass value="0.015"/>
    <inertia
    ixx="0.001"
    ixy="0.0"
    ixz="0.0"
    iyy="0.001"
    iyz="0"
    izz="0.001"/>
    </inertial>
 </link> 

<joint name="tilt" type="revolute">
    <parent link="${ns}/base_link"/>
    <child link="${ns}/camera"/>
    <origin xyz="${x_camera + .15} 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0" />
    <limit effort="100" velocity="5.0" lower="${-PI/3}" upper="${PI/3}"/>
    <dynamics damping="0.8"/>
</joint>

<link name="${ns}/camera_optical"/>

<joint name="camera_optical" type="fixed">
    <parent link="${ns}/camera"/>
    <child link="${ns}/camera_optical"/>
    <origin rpy="${-PI/2} 0 ${-PI/2}"/>
</joint>

<gazebo>
    <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
        <joint_name>tilt</joint_name>
        <p_gain>10.</p_gain>
        <i_gain>0.2</i_gain>
        <d_gain>0.1</d_gain>
        <i_max>10</i_max>
        <i_min>-10</i_min>
    </plugin>
</gazebo>

<xacro:if value="$(arg camera)">
 <gazebo reference="${ns}/camera">
    <sensor name="camera" type="camera">
    <camera>
    <optical_frame_id>${ns}/camera_optical</optical_frame_id>
    <horizontal_fov>1.047</horizontal_fov>
    <image>
        <width>640</width>
        <height>400</height>
    </image>
    <clip>
        <near>0.3</near>
        <far>100</far>
    </clip>
    </camera>
    <always_on>1</always_on>
    <update_rate>30</update_rate>
    <visualize>true</visualize>
    <topic>${ns}/image</topic>
    <enable_metrics>false</enable_metrics>
</sensor>
  </gazebo>
</xacro:if>



</robot>
