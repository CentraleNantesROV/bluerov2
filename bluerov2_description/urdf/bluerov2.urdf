<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from bluerov2.xacro                 | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="bluerov2">
  <!-- Vehicle base link -->
  <link name="bluerov2/base_link">
    <inertial>
      <mass value="14.8"/>
      <origin xyz="0 0 -0.11541050518760675"/>
      <!-- BlueROV2 values from "Model Predictive Control for the BlueROV2", 
        Emil Már Einarsson, Andris Lipenitis, Master thesis, 2020 
        for now make Ignition crash?-->
      <!--         <inertia ixx="0.21" ixy="0.00" ixz="0.00" iyy="0.245" iyz="0.00" izz="0.245"/> -->
      <inertia ixx="5.2539" ixy="0.0144" ixz="0.3341" iyy="7.9420" iyz="0.026" izz="6.9123"/>
      <!-- Perfect rectangle -->
      <!--        <inertia
        ixx="${mass/12*(y_size*y_size+z_size*z_size)}" ixy="0.0" ixz="0.0"
        iyy="${mass/12*(x_size*x_size + z_size*z_size)}" iyz="0.0"
        izz="${mass/12*(x_size*x_size + y_size*y_size)}" />-->
    </inertial>
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_noprop.dae"/>
      </geometry>
    </visual>
    <collision>
      <!-- Box adjusted for buoyancy -->
      <geometry>
        <box size="0.461642020750427 0.28852626296901684 0.11541050518760675"/>
      </geometry>
    </collision>
  </link>
  <gazebo>
    <plugin filename="libignition-gazebo-hydrodynamics-system.so" name="ignition::gazebo::systems::Hydrodynamics">
      <!-- Ignition notations from Handbook of Marine Craft, Fossen, 2011 -->
      <link_name>bluerov2/base_link</link_name>
      <!-- BlueROV2 heavy values from "6-DoF Modelling and Control of a Remotely Operated Vehicle"
        Wu, Master thesis, Flinder University, 2018  -->
      <!-- Negative diagonal values of added mass matrix [Fossen (6.38)] -->
      <xDotU>-5.5</xDotU>
      <yDotV>-12.7</yDotV>
      <zDotW>-14.57</zDotW>
      <kDotP>-0.12</kDotP>
      <mDotQ>-0.12</mDotQ>
      <nDotR>-0.12</nDotR>
      <!-- From "Numerical Modelling and Experimental Testing of the Hydrodynamic Characteristics 
        for an Open-Frame Remotely Operated Vehicle",  Li et al, Marine Science and Engineering, 2020         -->
      <!-- Negative linear damping [Fossen (6.62)] -->
      <!--    <xU>-1.31</xU>    
    <yV>-9.14</yV>
    <zW>-2.015</zW>
    <kP>-0.</kP>
    <mQ>-0.</mQ>
    <nR>-0.</nR>-->
      <!-- Negative quadratic damping [Fossen (6.62)] -->
      <!--    <xUU>38.169</xUU>    
    <yVV>-129.66</yVV>
    <zWW>-243.25</zWW>
    <kPP>-4.86</kPP>
    <mQQ>-4.86</mQQ>
    <nRR>-4.86</nRR>-->
      <!-- BlueROV2 values from "Model Predictive Control for the BlueROV2", 
        Emil Már Einarsson, Andris Lipenitis, Master thesis, 2020  -->
      <!-- Negative linear damping -->
      <xU>-25.15</xU>
      <yV>-7.364</yV>
      <zW>-17.955</zW>
      <kP>-1.888</kP>
      <mQ>-0.761</mQ>
      <nR>-3.744</nR>
      <!-- Negative quadratic damping -->
      <xUU>-17.77</xUU>
      <yVV>-125.9</yVV>
      <zWW>-72.36</zWW>
      <kPP>-0.1246</kPP>
      <mQQ>-0.1246</mQQ>
      <nRR>-0.1857</nRR>
    </plugin>
  </gazebo>
  <!-- all 6 thrusters -->
  <link name="bluerov2/thruster1">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster1" type="continuous">
    <origin rpy="0 0 0.7853981634" xyz="0.1355 -0.1 -0.0725"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster1"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster1</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/thruster2">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster2" type="continuous">
    <origin rpy="0 0 -0.7853981634" xyz="0.1355 0.1 -0.0725"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster2"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster2</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/thruster3">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster3" type="continuous">
    <origin rpy="0 0 2.3561944902" xyz="-0.1475 -0.1 -0.0725"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster3"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster3</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/thruster4">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster4" type="continuous">
    <origin rpy="0 0 -2.3561944902" xyz="-0.1475 0.1 -0.0725"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster4"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster4</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/thruster5">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster5" type="continuous">
    <origin rpy="0 -1.5707963268 0" xyz="0.0025 -0.1105 -0.005"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster5"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster5</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/thruster6">
    <visual>
      <geometry>
        <mesh filename="file:///home/olivier/code/ros2/install/bluerov2_description/share/bluerov2_description/meshes/bluerov2_propcw.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 1.57079635 0"/>
      <geometry>
        <cylinder length="0.035" radius="0.038"/>
      </geometry>
    </collision>
    <inertial>
      <!-- thruster axis is X -->
      <origin rpy="0 0 0" xyz="0.0175 0 0"/>
      <mass value="0.07"/>
      <inertia ixx="5.054e-05" ixy="0.0" ixz="0.0" iyy="3.2415833333333336e-05" iyz="0.0" izz="3.2415833333333336e-05"/>
    </inertial>
  </link>
  <!-- Joint between thruster link and vehicle base link -->
  <joint name="thruster6" type="continuous">
    <origin rpy="0 -1.5707963268 0" xyz="0.0025 0.1105 -0.005"/>
    <axis xyz="1 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/thruster6"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <!-- ignition topic is /model/{ns}/joint/{joint_name}/cmd_pos -->
  <!--    <xacro:if value="$(arg simulation)"> -->
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>bluerov2</namespace>
      <joint_name>thruster6</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.076</propeller_diameter>
    </plugin>
  </gazebo>
  <!--  </xacro:if> -->
  <link name="bluerov2/mpu">
    <inertial>
      <inertia ixx="0.00001" ixy="0.0" ixz="0.0" iyy="0.00001" iyz="0.0" izz="0.00001"/>
      <mass value="0.015"/>
    </inertial>
  </link>
  <gazebo reference="bluerov2/mpu">
    <sensor name="imu_sensor" type="imu">
      <always_on>1</always_on>
      <update_rate>100</update_rate>
      <visualize>false</visualize>
      <topic>bluerov2/mpu</topic>
    </sensor>
  </gazebo>
  <joint name="mpu" type="fixed">
    <origin rpy="3.1415927 0 0" xyz="0 0 0"/>
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/mpu"/>
  </joint>
  <!-- Pressure Sensor  -->
  <!--  <xacro:default_pressure parent_link="${ns}/base_link" sensor_name="baro">
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </xacro:default_pressure>-->
  <link name="bluerov2/camera">
    <inertial>
      <mass value="0.015"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <joint name="tilt" type="revolute">
    <parent link="bluerov2/base_link"/>
    <child link="bluerov2/camera"/>
    <origin rpy="0 1.57079635 0" xyz="0.16999999999999998 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="100" lower="-1.0471975666666666" upper="1.0471975666666666" velocity="5.0"/>
    <dynamics damping="0.8"/>
  </joint>
  <gazebo>
    <plugin filename="libignition-gazebo-joint-position-controller-system.so" name="ignition::gazebo::systems::JointPositionController">
      <joint_name>tilt</joint_name>
      <topic>bluerov2/tilt_cmd</topic>
      <p_gain>1.</p_gain>
      <i_gain>0.2</i_gain>
      <d_gain>0.1</d_gain>
      <i_max>10</i_max>
      <i_min>-10</i_min>
    </plugin>
  </gazebo>
  <gazebo reference="bluerov2/camera">
    <sensor name="camera" type="camera">
      <camera>
        <horizontal_fov>1.047</horizontal_fov>
        <image>
          <width>640</width>
          <height>400</height>
        </image>
        <clip>
          <near>0.3</near>
          <far>100</far>
        </clip>
      </camera>
      <always_on>1</always_on>
      <update_rate>30</update_rate>
      <visualize>true</visualize>
      <topic>bluerov2/image</topic>
      <enable_metrics>false</enable_metrics>
    </sensor>
  </gazebo>
  <gazebo>
    <plugin filename="libignition-gazebo-joint-state-publisher-system.so" name="ignition::gazebo::systems::JointStatePublisher"/>
    <plugin filename="libignition-gazebo-odometry-publisher-system.so" name="ignition::gazebo::systems::OdometryPublisher">
      <odom_frame>bluerov2/odom</odom_frame>
      <robot_base_frame>bluerov2/base_link</robot_base_frame>
      <odom_publish_frequency>10</odom_publish_frequency>
    </plugin>
    <plugin filename="libignition-gazebo-pose-publisher-system.so" name="ignition::gazebo::systems::PosePublisher">
      <publish_link_pose>false</publish_link_pose>
      <publish_collision_pose>false</publish_collision_pose>
      <publish_visual_pose>false</publish_visual_pose>
      <publish_nested_model_pose>true</publish_nested_model_pose>
    </plugin>
  </gazebo>
</robot>
